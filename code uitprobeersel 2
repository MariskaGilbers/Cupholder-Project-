#include <Stepper.h>


/* 
 *  stepsPerRevolution geeft aan hoeveel stapjes de microcontroller moet doen om 1
 *  keer rond te draaien.
 */
const int stepsPerRevolution = 360;
const int trigPin = 2;
const int echoPin = 4;
bool hasRun1 = false; 
bool hasRun2 = false;
bool hasRun3 = false;
bool hasRun4 = false;
bool hasRun5 = false;
bool hasRun6 = false;
bool hasRun7 = false;
bool hasRun8 = false;
Stepper myStepper(stepsPerRevolution, 8, 10, 9, 11);

/*
 * 
 * Variabele om de aantal stapjes in op te slaan.
 * Per rotatie is dat dus 360 stapjes.
 * Long variabele is 4 bytes breed en kan dus een hele hoop stapjes opslaan.
 * 
 */
long aantalstapjes = 0;

/*
 * 
 * variabele om het aantal rotaties te berekenen
 * Ook weer een long.
 * 
 */
long aantalrotaties = 0;

void setup() {
  // put your setup code here, to run once:
  myStepper.setSpeed(50);
  Serial.begin(9600);
}

void loop() {
  // put your main code here, to run repeatedly:
long duration, cm;
pinMode(trigPin, OUTPUT);

digitalWrite(trigPin, LOW);

delayMicroseconds(10);

digitalWrite(trigPin, HIGH);

delayMicroseconds(10);

digitalWrite(trigPin, LOW);

pinMode(echoPin, INPUT);

duration = pulseIn(echoPin, HIGH);

cm = microsecondsToCentimeters(duration);

Serial.print(cm);

Serial.print("cm");

Serial.println();

delay(500);

aantalstapjes = aantalstapjes + stepsPerRevolution;
aantalrotaties = aantalstapjes / stepsPerRevolution;

  if (cm  >= 4 && cm <= 6 && hasRun1 == false) {

    Serial.println("Aantal stapjes");
    Serial.print(aantalstapjes);

    myStepper.step(-stepsPerRevolution);
    hasRun1 = true;
  }
  
  if (cm >= 7 && cm <= 9 && hasRun2 == false) {
    
    Serial.println("Aantal stapjes");
    Serial.print(aantalstapjes);
    
    myStepper.step(-stepsPerRevolution);
    hasRun2 = true;
  }
  if (cm >= 10 && cm <= 12 && hasRun3 == false) {
    
    Serial.println("Aantal stapjes");
    Serial.print(aantalstapjes);
    
    myStepper.step(-stepsPerRevolution);
    hasRun3 = true;
  }
  if (cm >= 13 && cm <= 15 && hasRun4 == false) {
    
    Serial.println("Aantal stapjes");
    Serial.print(aantalstapjes);
    
    myStepper.step(-stepsPerRevolution);
    hasRun4 = true;
  }
  if (cm >= 16 && cm <= 18 && hasRun5 == false) {
    
    Serial.println("Aantal stapjes");
    Serial.print(aantalstapjes);
    
    myStepper.step(-stepsPerRevolution);
    hasRun5 = true;
  }
  if (cm >= 19 && cm <= 21 && hasRun6 == false) {
    
    Serial.println("Aantal stapjes");
    Serial.print(aantalstapjes);
    
    myStepper.step(-stepsPerRevolution);
    hasRun6 = true;
  }
  if (cm >= 22 && cm <= 24 && hasRun7 == false) {
    
    Serial.println("Aantal stapjes");
    Serial.print(aantalstapjes);
    
    myStepper.step(-stepsPerRevolution);
    hasRun7 = true;
  }
  if (cm >= 25 && cm <=27 && hasRun8 == false) {
    
    Serial.println("Aantal stapjes");
    Serial.print(aantalstapjes);
    
    myStepper.step(-stepsPerRevolution);
    hasRun8 = true;
  }
  if (cm >= 28) {
    
    Serial.println("downwards");
    
    myStepper.step(stepsPerRevolution*8);
  }
}
long microsecondsToCentimeters(long microseconds)

{return microseconds / 29 / 2;}
